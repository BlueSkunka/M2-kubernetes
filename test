server {
  listen      *:80;
  server_name oro.demo *.oro.demo;
  resolver 10.96.0.10 valid=5s;
  add_header "set_real_ip_from" "0.0.0.0/0";
  add_header "real_ip_header" "X-Real-IP";
  add_header "real_ip_recursive" "on";
  try_files $uri @rewrite;

  root /var/www/oro/public;

  index index.php;
  access_log /dev/stdout extended buffer=32k flush=5s;
  error_log  /dev/stdout error;

  error_page 501 /501.html;
  error_page 502 /502.html;
  error_page 503 /503.html;
  error_page 401 /401.html;
  error_page 451 /451.html;

  location /501.html {
    internal;
    try_files /error_pages/501.$host.html /error_pages/501.html @fallback_501;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_501 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /502.html {
    internal;
    try_files /error_pages/502.$host.html /error_pages/502.html @fallback_502;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_502 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /503.html {
    internal;
    try_files /error_pages/503.$host.html /error_pages/503.html @fallback_503;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_503 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /401.html {
    internal;
    try_files /error_pages/401.$host.html /error_pages/401.html @fallback_401;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_401 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /451.html {
    internal;
    try_files /error_pages/451.$host.html /error_pages/451.html @fallback_451;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_451 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /status {
    allow 127.0.0.1;
    allow 10.0.0.0/8;
    deny all;
    stub_status on;
    access_log off;
  }

  location =/OroCommerce.png {
    root /var/www/html;
  }

  location =/robots.txt {
    try_files /media/sitemaps/robots.$host.txt @robots;
    access_log off;
    log_not_found off;
    more_clear_headers Server;
    more_clear_headers X-Page-Speed;
    more_clear_headers X-Powered-By;
    more_clear_headers X-CF-Powered-By;
    add_header Cache-Control no-cache;
  }

  location @robots {
    rewrite ^ /media/sitemaps/robots.$host.txt;
    access_log off;
    log_not_found off;
    more_clear_headers Server;
    more_clear_headers X-Page-Speed;
    more_clear_headers X-Powered-By;
    more_clear_headers X-CF-Powered-By;
    add_header Cache-Control no-cache;
  }

  location @rewrite {
    if (-f /var/www/oro/var/maintenance/global_lock) { add_header "Cache-Control" "no-cache"; return 503; }
    if (-f /var/www/oro/var/maintenance/maintenance_lock) { add_header "Cache-Control" "no-cache"; return 503; }
    rewrite ^/(.*)$ /index.php/$1;
  }

  location ~ /tracking\.php(/|$) {
    if (!-f $realpath_root$fastcgi_script_name) { return 404; }
    include fastcgi.conf;
    fastcgi_pass app;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;
    fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
    fastcgi_param DOCUMENT_ROOT $realpath_root;
    fastcgi_param GEOIP2_COUNTRY_CODE $geoip2_data_country_code;
    fastcgi_param GEOIP2_SUBDIVISION_ISO_CODE $geoip2_subdivisions_iso_code;
    fastcgi_param HTTPS on;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param PHP_PATH /usr/bin/php;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    break;
  }

  location ~ /index\.php(/|$) {
    internal;
    if (!-f $realpath_root$fastcgi_script_name) { return 404; }
    include fastcgi.conf;
    fastcgi_pass app;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;
    fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
    fastcgi_param DOCUMENT_ROOT $realpath_root;
    fastcgi_param GEOIP2_COUNTRY_CODE $geoip2_data_country_code;
    fastcgi_param GEOIP2_SUBDIVISION_ISO_CODE $geoip2_subdivisions_iso_code;
    fastcgi_param HTTPS off;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param PHP_PATH /usr/bin/php;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    break;
  }

  location =/ws {
    reset_timedout_connection on;
    proxy_pass http://ws/;
    proxy_read_timeout 86400s;
    proxy_connect_timeout 180s;
    proxy_send_timeout 180s;
    proxy_redirect off;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-NginX-Proxy true;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection upgrade;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    proxy_buffer_size 64k;
    proxy_buffers 8 32k;
  }

  location ~* \.(?:jpg|jpeg|gif|png|ico|tiff|woff|woff2|eot|ttf|svg|svgz|mp4|ogg|ogv|webm|swf|flv|pdf|ppt|txt|bmp|rtf|webp|css|js|json)$ {
    set $limit_whitelist 0;
    if ( -f $request_filename ) { expires 30d; add_header "Cache-Control" "public"; }
    try_files $uri @rewrite;
    access_log off;
    log_not_found off;
    more_clear_headers Server;
    more_clear_headers X-Page-Speed;
    more_clear_headers X-Powered-By;
    more_clear_headers X-CF-Powered-By;
  }

  location ^~ /media/ {
    expires 3w;
    add_header "Cache-Control" "public";
    if ( $request_filename ~ robots(\..+)?\.txt$ ) { add_header "Cache-Control" "no-cache"; }
    if ( $request_filename ~ sitemaps(\/\.+)$ ) { add_header "Cache-Control" "no-cache"; }
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    recursive_error_pages on;
    error_page 404 = @rewrite;
  }

  location ~ /\.ht {
    deny all;
  }

  location ~ \.php$ {
    deny all;
  }

  if ($host ~* ^\*\.(.+)) {
      return 404;
  }
}
bash-4.4$ command terminated with exit code 137
<<K9s-Shell>> Pod: orocommerce/orocommerce-nginx-787777b898-v26k5 | Container: nginx
bash-4.4$ cat /opt/oro-nginx/etc/sites-enabled/oro_demo.conf

server {
  listen      *:80;
  server_name oro.demo *.oro.demo;
  resolver 10.96.0.10 valid=5s;
  add_header "set_real_ip_from" "0.0.0.0/0";
  add_header "real_ip_header" "X-Real-IP";
  add_header "real_ip_recursive" "on";
  try_files $uri @rewrite;

  root /var/www/oro/public;

  index index.php;
  access_log /dev/stdout extended buffer=32k flush=5s;
  error_log  /dev/stdout error;

  error_page 501 /501.html;
  error_page 502 /502.html;
  error_page 503 /503.html;
  error_page 401 /401.html;
  error_page 451 /451.html;

  location /501.html {
    internal;
    try_files /error_pages/501.$host.html /error_pages/501.html @fallback_501;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_501 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /502.html {
    internal;
    try_files /error_pages/502.$host.html /error_pages/502.html @fallback_502;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_502 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /503.html {
    internal;
    try_files /error_pages/503.$host.html /error_pages/503.html @fallback_503;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_503 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /401.html {
    internal;
    try_files /error_pages/401.$host.html /error_pages/401.html @fallback_401;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_401 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /451.html {
    internal;
    try_files /error_pages/451.$host.html /error_pages/451.html @fallback_451;
    root /var/www/oro/var/maintenance;
  }

  location @fallback_451 {
    root /var/www/html;
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    add_header "Cache-Control" "no-cache";
  }

  location /status {
    allow 127.0.0.1;
    allow 10.0.0.0/8;
    deny all;
    stub_status on;
    access_log off;
  }

  location =/OroCommerce.png {
    root /var/www/html;
  }

  location =/robots.txt {
    try_files /media/sitemaps/robots.$host.txt @robots;
    access_log off;
    log_not_found off;
    more_clear_headers Server;
    more_clear_headers X-Page-Speed;
    more_clear_headers X-Powered-By;
    more_clear_headers X-CF-Powered-By;
    add_header Cache-Control no-cache;
  }

  location @robots {
    rewrite ^ /media/sitemaps/robots.$host.txt;
    access_log off;
    log_not_found off;
    more_clear_headers Server;
    more_clear_headers X-Page-Speed;
    more_clear_headers X-Powered-By;
    more_clear_headers X-CF-Powered-By;
    add_header Cache-Control no-cache;
  }

  location @rewrite {
    if (-f /var/www/oro/var/maintenance/global_lock) { add_header "Cache-Control" "no-cache"; return 503; }
    if (-f /var/www/oro/var/maintenance/maintenance_lock) { add_header "Cache-Control" "no-cache"; return 503; }
    rewrite ^/(.*)$ /index.php/$1;
  }

  location ~ /tracking\.php(/|$) {
    if (!-f $realpath_root$fastcgi_script_name) { return 404; }
    include fastcgi.conf;
    fastcgi_pass app;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;
    fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
    fastcgi_param DOCUMENT_ROOT $realpath_root;
    fastcgi_param GEOIP2_COUNTRY_CODE $geoip2_data_country_code;
    fastcgi_param GEOIP2_SUBDIVISION_ISO_CODE $geoip2_subdivisions_iso_code;
    fastcgi_param HTTPS on;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param PHP_PATH /usr/bin/php;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    break;
  }

  location ~ /index\.php(/|$) {
    internal;
    if (!-f $realpath_root$fastcgi_script_name) { return 404; }
    include fastcgi.conf;
    fastcgi_pass app;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;
    fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
    fastcgi_param DOCUMENT_ROOT $realpath_root;
    fastcgi_param GEOIP2_COUNTRY_CODE $geoip2_data_country_code;
    fastcgi_param GEOIP2_SUBDIVISION_ISO_CODE $geoip2_subdivisions_iso_code;
    fastcgi_param HTTPS off;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param PHP_PATH /usr/bin/php;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    break;
  }

  location =/ws {
    reset_timedout_connection on;
    proxy_pass http://ws/;
    proxy_read_timeout 86400s;
    proxy_connect_timeout 180s;
    proxy_send_timeout 180s;
    proxy_redirect off;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-NginX-Proxy true;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection upgrade;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    proxy_buffer_size 64k;
    proxy_buffers 8 32k;
  }

  location ~* \.(?:jpg|jpeg|gif|png|ico|tiff|woff|woff2|eot|ttf|svg|svgz|mp4|ogg|ogv|webm|swf|flv|pdf|ppt|txt|bmp|rtf|webp|css|js|json)$ {
    set $limit_whitelist 0;
    if ( -f $request_filename ) { expires 30d; add_header "Cache-Control" "public"; }
    try_files $uri @rewrite;
    access_log off;
    log_not_found off;
    more_clear_headers Server;
    more_clear_headers X-Page-Speed;
    more_clear_headers X-Powered-By;
    more_clear_headers X-CF-Powered-By;
  }

  location ^~ /media/ {
    expires 3w;
    add_header "Cache-Control" "public";
    if ( $request_filename ~ robots(\..+)?\.txt$ ) { add_header "Cache-Control" "no-cache"; }
    if ( $request_filename ~ sitemaps(\/\.+)$ ) { add_header "Cache-Control" "no-cache"; }
    access_log off;
    log_not_found off;
    more_clear_headers Server X-Page-Speed X-Powered-By X-CF-Powered-By;
    recursive_error_pages on;
    error_page 404 = @rewrite;
  }

  location ~ /\.ht {
    deny all;
  }

  location ~ \.php$ {
    deny all;
  }

  if ($host ~* ^\*\.(.+)) {
      return 404;
  }
}
